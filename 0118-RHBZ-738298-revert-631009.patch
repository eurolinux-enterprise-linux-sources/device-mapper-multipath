---
 kpartx/devmapper.c       |   14 +++-----------
 kpartx/devmapper.h       |    2 +-
 kpartx/kpartx.c          |   11 +++--------
 libmultipath/config.h    |    1 -
 libmultipath/devmapper.c |   12 ++----------
 multipath/main.c         |    1 -
 6 files changed, 9 insertions(+), 32 deletions(-)

Index: multipath-tools/kpartx/devmapper.c
===================================================================
--- multipath-tools.orig/kpartx/devmapper.c
+++ multipath-tools/kpartx/devmapper.c
@@ -53,8 +53,7 @@ dm_prereq (char * str, int x, int y, int
 }
 
 extern int
-dm_simplecmd (int task, const char *name, int no_flush, uint32_t *cookie,
-	      int force_udev_rules) {
+dm_simplecmd (int task, const char *name, int no_flush, uint32_t *cookie) {
 	int r = 0;
 	int udev_wait_flag = (task == DM_DEVICE_RESUME ||
 			      task == DM_DEVICE_REMOVE);
@@ -72,15 +71,8 @@ dm_simplecmd (int task, const char *name
 	if (no_flush)
 		dm_task_no_flush(dmt);
 
-	if (udev_wait_flag) {
-		if (!dm_task_set_cookie(dmt, cookie, (force_udev_rules)? 0 :
-					DM_UDEV_DISABLE_DISK_RULES_FLAG))
-			goto out;
-	}
-	else if (task == DM_DEVICE_RESUME && dm_cookie_supported() &&
-		 !force_udev_rules)
-		dm_task_set_event_nr(dmt, DM_UDEV_DISABLE_DISK_RULES_FLAG <<
-					  DM_UDEV_FLAGS_SHIFT);
+	if (udev_wait_flag && !dm_task_set_cookie(dmt, cookie, 0))
+		goto out;
 	r = dm_task_run(dmt);
 
 	out:
Index: multipath-tools/kpartx/devmapper.h
===================================================================
--- multipath-tools.orig/kpartx/devmapper.h
+++ multipath-tools/kpartx/devmapper.h
@@ -3,7 +3,7 @@
 #define MKDEV(ma,mi)    ((mi & 0xff) | (ma << 8) | ((mi & ~0xff) << 12))
 
 int dm_prereq (char *, int, int, int);
-int dm_simplecmd (int, const char *, int, uint32_t *, int);
+int dm_simplecmd (int, const char *, int, uint32_t *);
 int dm_addmap (int, const char *, const char *, const char *, uint64_t,
 	       const char *, int, mode_t, uid_t, gid_t, uint32_t *);
 int dm_map_present (char *);
Index: multipath-tools/kpartx/kpartx.c
===================================================================
--- multipath-tools.orig/kpartx/kpartx.c
+++ multipath-tools/kpartx/kpartx.c
@@ -187,8 +187,7 @@ get_hotplug_device(void)
 }
 
 int
-main(int argc, char **argv)
-{
+main(int argc, char **argv){
 	int fd, i, j, k, n, op, off, arg;
 	struct slice all;
 	struct pt *ptp;
@@ -206,7 +205,6 @@ main(int argc, char **argv)
 	int sync = 0;
 	struct stat buf;
 	uint32_t cookie = 0;
-	int force_udev_rules = 0;
 
 	initpts();
 	init_crc32();
@@ -266,7 +264,6 @@ main(int argc, char **argv)
 			sync = 1;
 			break;
 		case 'u':
-			force_udev_rules = 1;
 			break;
 		default:
 			usage();
@@ -421,8 +418,7 @@ main(int argc, char **argv)
 					continue;
 
 				if (!dm_simplecmd(DM_DEVICE_REMOVE, partname,
-						  0, &cookie,
-						  force_udev_rules)) {
+						  0, &cookie)) {
 					r++;
 					continue;
 				}
@@ -472,8 +468,7 @@ main(int argc, char **argv)
 				}
 				if (op == DM_DEVICE_RELOAD &&
 				    !dm_simplecmd(DM_DEVICE_RESUME, partname,
-						  1, &cookie,
-						  force_udev_rules)) {
+						  1, &cookie)) {
 					fprintf(stderr, "resume failed on %s\n",
 						partname);
 					r++;
Index: multipath-tools/libmultipath/config.h
===================================================================
--- multipath-tools.orig/libmultipath/config.h
+++ multipath-tools/libmultipath/config.h
@@ -94,7 +94,6 @@ struct config {
 	int find_multipaths;
 	int allow_queueing;
 	int log_checker_err;
-	int force_udev_rules;
 	uid_t uid;
 	gid_t gid;
 	mode_t mode;
Index: multipath-tools/libmultipath/devmapper.c
===================================================================
--- multipath-tools.orig/libmultipath/devmapper.c
+++ multipath-tools/libmultipath/devmapper.c
@@ -213,16 +213,8 @@ dm_simplecmd (int task, const char *name
 		dm_task_no_flush(dmt);		/* for DM_DEVICE_SUSPEND/RESUME */
 #endif
 
-	if (udev_wait_flag) {
-		if (!dm_task_set_cookie(dmt, &conf->cookie,
-					(conf->force_udev_rules)? 0 :
-					DM_UDEV_DISABLE_DISK_RULES_FLAG))
-			goto out;
-	}
-	else if (task == DM_DEVICE_RESUME && dm_cookie_supported() &&
-		 !conf->force_udev_rules)
-		dm_task_set_event_nr(dmt, DM_UDEV_DISABLE_DISK_RULES_FLAG <<
-					  DM_UDEV_FLAGS_SHIFT);
+	if (udev_wait_flag && !dm_task_set_cookie(dmt, &conf->cookie, 0))
+		goto out;
 	r = dm_task_run (dmt);
 
 	out:
Index: multipath-tools/multipath/main.c
===================================================================
--- multipath-tools.orig/multipath/main.c
+++ multipath-tools/multipath/main.c
@@ -440,7 +440,6 @@ main (int argc, char *argv[])
 			conf->force_reload = 1;
 			break;
 		case 'u':
-			conf->force_udev_rules = 1;
 			break;
 		case 'h':
 			usage(argv[0]);
